{"version":3,"sources":["../../../src/provider.ts","../../../src/http.ts","../../../src/index.ts"],"names":["this","signer","connection"],"mappings":"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","file":"static/js/3.c6929e21.chunk.js","sourcesContent":["import { EventEmitter } from \"events\";\nimport { IJsonRpcProvider, isJsonRpcResponse, formatJsonRpcRequest, isJsonRpcError, } from \"@walletconnect/jsonrpc-utils\";\nexport class JsonRpcProvider extends IJsonRpcProvider {\n    constructor(connection) {\n        super(connection);\n        this.events = new EventEmitter();\n        this.hasRegisteredEventListeners = false;\n        this.connection = this.setConnection(connection);\n        if (this.connection.connected) {\n            this.registerEventListeners();\n        }\n    }\n    async connect(connection = this.connection) {\n        await this.open(connection);\n    }\n    async disconnect() {\n        await this.close();\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    async request(request, context) {\n        return this.requestStrict(formatJsonRpcRequest(request.method, request.params || []), context);\n    }\n    async requestStrict(request, context) {\n        return new Promise(async (resolve, reject) => {\n            if (!this.connection.connected) {\n                try {\n                    await this.open();\n                }\n                catch (e) {\n                    reject(e);\n                }\n            }\n            this.events.on(`${request.id}`, response => {\n                if (isJsonRpcError(response)) {\n                    reject(response.error);\n                }\n                else {\n                    resolve(response.result);\n                }\n            });\n            try {\n                await this.connection.send(request, context);\n            }\n            catch (e) {\n                reject(e);\n            }\n        });\n    }\n    setConnection(connection = this.connection) {\n        return connection;\n    }\n    onPayload(payload) {\n        this.events.emit(\"payload\", payload);\n        if (isJsonRpcResponse(payload)) {\n            this.events.emit(`${payload.id}`, payload);\n        }\n        else {\n            this.events.emit(\"message\", {\n                type: payload.method,\n                data: payload.params,\n            });\n        }\n    }\n    async open(connection = this.connection) {\n        if (this.connection === connection && this.connection.connected)\n            return;\n        if (this.connection.connected)\n            this.close();\n        if (typeof connection === \"string\") {\n            await this.connection.open(connection);\n            connection = this.connection;\n        }\n        this.connection = this.setConnection(connection);\n        await this.connection.open();\n        this.registerEventListeners();\n        this.events.emit(\"connect\");\n    }\n    async close() {\n        await this.connection.close();\n    }\n    registerEventListeners() {\n        if (this.hasRegisteredEventListeners)\n            return;\n        this.connection.on(\"payload\", (payload) => this.onPayload(payload));\n        this.connection.on(\"close\", () => this.events.emit(\"disconnect\"));\n        this.connection.on(\"error\", (error) => this.events.emit(\"error\", error));\n        this.hasRegisteredEventListeners = true;\n    }\n}\nexport default JsonRpcProvider;\n//# sourceMappingURL=provider.js.map","import { EventEmitter } from \"events\";\nimport fetch from \"cross-fetch\";\nimport { safeJsonParse, safeJsonStringify } from \"@walletconnect/safe-json\";\nimport { formatJsonRpcError, isHttpUrl, parseConnectionError, } from \"@walletconnect/jsonrpc-utils\";\nconst DEFAULT_HTTP_HEADERS = {\n    Accept: \"application/json\",\n    \"Content-Type\": \"application/json\",\n};\nconst DEFAULT_HTTP_METHOD = \"POST\";\nconst DEFAULT_FETCH_OPTS = {\n    headers: DEFAULT_HTTP_HEADERS,\n    method: DEFAULT_HTTP_METHOD,\n};\nexport class HttpConnection {\n    constructor(url) {\n        this.url = url;\n        this.events = new EventEmitter();\n        this.isAvailable = false;\n        this.registering = false;\n        if (!isHttpUrl(url)) {\n            throw new Error(`Provided URL is not compatible with HTTP connection: ${url}`);\n        }\n        this.url = url;\n    }\n    get connected() {\n        return this.isAvailable;\n    }\n    get connecting() {\n        return this.registering;\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    async open(url = this.url) {\n        await this.register(url);\n    }\n    async close() {\n        if (!this.isAvailable) {\n            throw new Error(\"Connection already closed\");\n        }\n        this.onClose();\n    }\n    async send(payload, context) {\n        if (!this.isAvailable) {\n            await this.register();\n        }\n        try {\n            const body = safeJsonStringify(payload);\n            const res = await fetch(this.url, Object.assign(Object.assign({}, DEFAULT_FETCH_OPTS), { body }));\n            const data = await res.json();\n            this.onPayload({ data });\n        }\n        catch (e) {\n            this.onError(payload.id, e);\n        }\n    }\n    async register(url = this.url) {\n        if (!isHttpUrl(url)) {\n            throw new Error(`Provided URL is not compatible with HTTP connection: ${url}`);\n        }\n        if (this.registering) {\n            return new Promise((resolve, reject) => {\n                this.events.once(\"register_error\", error => {\n                    reject(error);\n                });\n                this.events.once(\"open\", () => {\n                    if (typeof this.isAvailable === \"undefined\") {\n                        return reject(new Error(\"HTTP connection is missing or invalid\"));\n                    }\n                    resolve();\n                });\n            });\n        }\n        this.url = url;\n        this.registering = true;\n        try {\n            const body = safeJsonStringify({ id: 1, jsonrpc: \"2.0\", method: \"test\", params: [] });\n            await fetch(url, Object.assign(Object.assign({}, DEFAULT_FETCH_OPTS), { body }));\n            this.onOpen();\n        }\n        catch (e) {\n            const error = this.parseError(e);\n            this.events.emit(\"register_error\", error);\n            this.onClose();\n            throw error;\n        }\n    }\n    onOpen() {\n        this.isAvailable = true;\n        this.registering = false;\n        this.events.emit(\"open\");\n    }\n    onClose() {\n        this.isAvailable = false;\n        this.registering = false;\n        this.events.emit(\"close\");\n    }\n    onPayload(e) {\n        if (typeof e.data === \"undefined\")\n            return;\n        const payload = typeof e.data === \"string\" ? safeJsonParse(e.data) : e.data;\n        this.events.emit(\"payload\", payload);\n    }\n    onError(id, e) {\n        const error = this.parseError(e);\n        const message = error.message || error.toString();\n        const payload = formatJsonRpcError(id, message);\n        this.events.emit(\"payload\", payload);\n    }\n    parseError(e, url = this.url) {\n        return parseConnectionError(e, url, \"HTTP\");\n    }\n}\nexport default HttpConnection;\n//# sourceMappingURL=http.js.map","import EventEmitter from \"eventemitter3\";\nimport { JsonRpcProvider } from \"@walletconnect/jsonrpc-provider\";\nimport { HttpConnection } from \"@walletconnect/jsonrpc-http-connection\";\nimport { getRpcUrl, signingMethods } from \"@walletconnect/utils\";\nimport { SignerConnection } from \"@walletconnect/signer-connection\";\nclass WalletConnectProvider {\n    constructor(opts) {\n        this.events = new EventEmitter();\n        this.rpc = { infuraId: opts === null || opts === void 0 ? void 0 : opts.infuraId, custom: opts === null || opts === void 0 ? void 0 : opts.rpc };\n        this.signer = new JsonRpcProvider(new SignerConnection(opts));\n        const chainId = this.signer.connection.chainId || (opts === null || opts === void 0 ? void 0 : opts.chainId) || 1;\n        this.http = this.setHttpProvider(chainId);\n        this.registerEventListeners();\n    }\n    get connected() {\n        return this.signer.connection.connected;\n    }\n    get connector() {\n        return this.signer.connection.connector;\n    }\n    get accounts() {\n        return this.signer.connection.accounts;\n    }\n    get chainId() {\n        return this.signer.connection.chainId;\n    }\n    get rpcUrl() {\n        var _a;\n        return ((_a = this.http) === null || _a === void 0 ? void 0 : _a.connection).url || \"\";\n    }\n    async request(args) {\n        switch (args.method) {\n            case \"eth_requestAccounts\":\n                await this.connect();\n                return this.signer.connection.accounts;\n            case \"eth_accounts\":\n                return this.signer.connection.accounts;\n            case \"eth_chainId\":\n                return this.signer.connection.chainId;\n            default:\n                break;\n        }\n        if (signingMethods.includes(args.method)) {\n            return this.signer.request(args);\n        }\n        if (typeof this.http === \"undefined\") {\n            throw new Error(`Cannot request JSON-RPC method (${args.method}) without provided rpc url`);\n        }\n        return this.http.request(args);\n    }\n    sendAsync(args, callback) {\n        this.request(args)\n            .then(response => callback(null, response))\n            .catch(error => callback(error, undefined));\n    }\n    async enable() {\n        const accounts = await this.request({ method: \"eth_requestAccounts\" });\n        return accounts;\n    }\n    async connect() {\n        if (!this.signer.connection.connected) {\n            await this.signer.connect();\n        }\n    }\n    async disconnect() {\n        if (this.signer.connection.connected) {\n            await this.signer.disconnect();\n        }\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    get isWalletConnect() {\n        return true;\n    }\n    registerEventListeners() {\n        this.signer.connection.on(\"accountsChanged\", accounts => {\n            this.events.emit(\"accountsChanged\", accounts);\n        });\n        this.signer.connection.on(\"chainChanged\", chainId => {\n            this.http = this.setHttpProvider(chainId);\n            this.events.emit(\"chainChanged\", chainId);\n        });\n        this.signer.on(\"disconnect\", () => {\n            this.events.emit(\"disconnect\");\n        });\n    }\n    setHttpProvider(chainId) {\n        const rpcUrl = getRpcUrl(chainId, this.rpc);\n        if (typeof rpcUrl === \"undefined\")\n            return undefined;\n        const http = new JsonRpcProvider(new HttpConnection(rpcUrl));\n        return http;\n    }\n}\nexport default WalletConnectProvider;\n//# sourceMappingURL=index.js.map"],"sourceRoot":""}